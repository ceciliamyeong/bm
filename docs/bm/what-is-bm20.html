<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>What is BM20?</title>
<style>
:root{--bg:#fff;--text:#111;--muted:#5c6b7a;--brand:#1A237E;--up:#2E7D32;--down:#C62828}
*{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--text);font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
.wrap{max-width:1080px;margin:0 auto;padding:20px}
.hero{background:#f5f7fb;border:1px solid #e5e9f0;border-radius:14px;padding:18px;margin:10px 0}
.tbl{width:100%;border-collapse:collapse;font-size:14px}
.tbl th,.tbl td{padding:8px;border-bottom:1px solid #e5e9f0}
.tbl th{text-align:left}
.sub{color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <h1>What is BM20?</h1>
  <div class="hero">
    <p>BM20은 글로벌 암호화폐 시장을 대표하는 <strong>대형 코인 20개</strong>로 구성된 블록미디어 고유 지수입니다. 한국 3대 거래소 상장 종목에 <strong>1.3배 가중치</strong>를 적용하고, <strong>분기 1회</strong> 리밸런싱합니다. 지수 기준일은 <strong>2018-01-01 (=100)</strong> 입니다.</p>
    <ul class="sub">
      <li>가중치 상한: BTC 30%, ETH 20%, XRP/BNB/USDT 각 5%, 나머지 15종 균등 35%</li>
      <li>데이터 소스: Coingecko(기본), Yahoo Finance(폴백)</li>
      <li>활용: 데일리 시황, 히스토리 차트, 베스트/워스트, 뉴스 자동문장</li>
    </ul>
  </div>

  <h2>구성 종목 (실시간)</h2>
  <table class="tbl" id="tbl"><tr><td>로딩 중…</td></tr></table>

  <h2>FAQ</h2>
  <details><summary><strong>BM20은 무엇인가요?</strong></summary><p>대형 20개 코인의 성과를 추적하는 기준 지수입니다.</p></details>
  <details><summary><strong>왜 만들었나요?</strong></summary><p>일일 시황 코멘터리, 장기 벤치마크(ETF/펀드/파생)로 확장하기 위함입니다.</p></details>
  <details><summary><strong>어떤 점이 다른가요?</strong></summary><p>국내 상장 코인 보정(1.3x)과 상한 규칙, 분기 리밸런싱 규율을 명확히 공개합니다.</p></details>
</div>

<script>
const v = Date.now();
// 구성 시트(실시간 CSV)
const COMPONENTS_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTndyrPd3WWwFtfzv2CZxJeDcH-l8ibQIdO5ouYS4HsaGpbeXQQbs6WEr9qPqqZbRoT6cObdFxJpief/pub?gid=1533548287&single=true&output=csv&v="+v;

async function fetchText(u){const r=await fetch(u);if(!r.ok)throw new Error("fetch fail");return r.text();}
function csvParse(t){
  const rows=t.trim().split(/\r?\n/).map(l=>l.split(",").map(s=>s.trim()));
  const header=rows[0]; return rows.slice(1).map(r=>Object.fromEntries(header.map((h,i)=>[h.trim(),r[i]??""])));
}
function num(x, d=""){const n=+String(x).replace(/[, ]/g,""); return isFinite(n)?n.toLocaleString():d;}

(async ()=>{
  try{
    const rows = csvParse(await fetchText(COMPONENTS_CSV));
    // 열 추정
    const symK = Object.keys(rows[0]).find(k=>/symbol|심볼/i.test(k))||"Symbol";
    const nameK= Object.keys(rows[0]).find(k=>/name|이름/i.test(k))||"Name";
    const pxK  = Object.keys(rows[0]).find(k=>/price|가격/i.test(k))||"Price";
    const mcK  = Object.keys(rows[0]).find(k=>/m.?arket.?cap|시가총액/i.test(k))||"Market Cap";
    const vK   = Object.keys(rows[0]).find(k=>/24.?h.*vol|volume/i.test(k))||"24h Volume";
    const chK  = Object.keys(rows[0]).find(k=>/change_?24h|24h.*(chg|ret)|ret_?1d|1d/i.test(k))||"change_24h";
    const wK   = Object.keys(rows[0]).find(k=>/weight|가중치/i.test(k))||null;

    const thead = `<tr>
      <th>Symbol</th><th>Name</th>
      <th style="text-align:right">Price</th>
      <th style="text-align:right">Market Cap</th>
      <th style="text-align:right">24h Vol</th>
      <th style="text-align:right">24h</th>
      ${wK?'<th style="text-align:right">Weight</th>':''}
    </tr>`;

    const tbody = rows.map(o=>{
      const ch = parseFloat(String(o[chK]??"").replace(/[% ]/g,""));
      const chStr = isFinite(ch) ? (ch>=0?`<span style="color:#2E7D32">+${ch.toFixed(2)}%</span>`:`<span style="color:#C62828">${ch.toFixed(2)}%</span>`) : "";
      return `<tr>
        <td>${o[symK]||""}</td>
        <td>${o[nameK]||""}</td>
        <td style="text-align:right">${num(o[pxK])}</td>
        <td style="text-align:right">${num(o[mcK])}</td>
        <td style="text-align:right">${num(o[vK])}</td>
        <td style="text-align:right">${chStr}</td>
        ${wK?`<td style="text-align:right">${(parseFloat(o[wK])*100||0).toFixed(2)}%</td>`:""}
      </tr>`;
    }).join("");

    document.getElementById("tbl").innerHTML = thead + tbody;
  }catch(e){
    document.getElementById("tbl").innerHTML = `<tr><td>구성 데이터를 불러오지 못했습니다.</td></tr>`;
    console.warn(e);
  }
})();
</script>
</body>
</html>
