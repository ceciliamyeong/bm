<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Upbit Top5 Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#ffffff;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --accent:#2563eb;
    }

    *{box-sizing:border-box}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Arial,sans-serif;
      margin:24px;
      background:var(--bg);
      color:var(--text);
    }

    h1{font-size:24px;margin:0 0 20px}
    h2{margin:0 0 12px;font-size:18px}

    .row{
      display:grid;
      grid-template-columns:1fr;
      gap:16px;
    }
    @media (min-width:900px){
      .row{grid-template-columns:1fr 1fr}
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:14px;
      padding:16px;
      box-shadow:0 4px 14px rgba(0,0,0,.04);
    }

    canvas{
      width:100% !important;
      height:360px !important;
    }

    .sub{
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
    }
  </style>
</head>

<body>
  <h1>Upbit Top5 Tracker</h1>

  <div class="row">
    <div class="card">
      <h2>Top5 Turnover (24h)</h2>
      <div class="sub">거래대금 기준 상위 5개 종목 비중</div>
      <canvas id="top5Pie"></canvas>
    </div>

    <div class="card">
      <h2>Top5 Concentration — 30D</h2>
      <div class="sub">상위 5개 종목 거래 집중도 추이</div>
      <canvas id="top5Line"></canvas>
    </div>
  </div>

<script>
/* ===== 공통 Chart.js 화이트 테마 ===== */
Chart.defaults.color = '#374151';               // 기본 텍스트 (검정 제거)
Chart.defaults.borderColor = '#e5e7eb';         // 축/그리드
Chart.defaults.font.family =
  'system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Arial,sans-serif';

/* ===== 유틸 ===== */
async function loadJSON(url){
  const r = await fetch(url, {cache:'no-cache'});
  if (!r.ok) throw new Error('fetch failed: ' + url);
  return await r.json();
}

(async () => {
  const SNAP_URL = "../assets/top5/top5_snapshot.json";
  const TS_URL   = "../assets/top5/top5_concentration.json";

  /* ===== Pie ===== */
  const snap = await loadJSON(SNAP_URL);
  const labels = snap.top5.map(x => x.symbol);
  const values = snap.top5.map(x => x.turnover_24h);

  new Chart(document.getElementById('top5Pie'), {
    type:'pie',
    data:{
      labels,
      datasets:[{
        data:values,
        backgroundColor:[
          '#2563eb','#3b82f6','#60a5fa','#93c5fd','#bfdbfe'
        ],
        borderWidth:1,
        borderColor:'#ffffff'
      }]
    },
    options:{
      plugins:{
        title:{
          display:true,
          text:`As of ${snap.as_of_kst} (KST)`,
          color:'#6b7280',
          font:{size:12,weight:'normal'}
        },
        tooltip:{
          callbacks:{
            label:(ctx)=>`${ctx.label}: ${Number(ctx.raw).toLocaleString()} KRW`
          }
        },
        legend:{
          position:'bottom',
          labels:{boxWidth:12}
        }
      }
    }
  });

  /* ===== Line ===== */
  const ts = await loadJSON(TS_URL);
  const dates = ts.series.map(x => x.date);
  const shares = ts.series.map(x => x.top5_share_pct);

  new Chart(document.getElementById('top5Line'), {
    type:'line',
    data:{
      labels:dates,
      datasets:[{
        label:'Top5 Share (%)',
        data:shares,
        borderColor:'#2563eb',
        backgroundColor:'rgba(37,99,235,.08)',
        tension:0.25,
        pointRadius:2,
        fill:true
      }]
    },
    options:{
      scales:{
        x:{
          ticks:{maxTicksLimit:8,color:'#6b7280'},
          grid:{color:'#f1f5f9'}
        },
        y:{
          suggestedMin:0,
          suggestedMax:100,
          ticks:{color:'#6b7280'},
          grid:{color:'#f1f5f9'}
        }
      },
      plugins:{
        title:{
          display:true,
          text:`Lookback ${ts.lookback_days}d (As of ${ts.as_of_kst})`,
          color:'#6b7280',
          font:{size:12,weight:'normal'}
        },
        legend:{display:false}
      }
    }
  });
})();
</script>
</body>
</html>

