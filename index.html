<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BM20 Index â€” Latest</title>
  <style>
    :root{--bg:#0b1020;--card:#11172a;--muted:#8aa0b5;--text:#e8f0ff;--up:#2E7D32;--down:#C62828;--brand:#1A237E;--accent:#4c74f2;}
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font:15px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Apple Color Emoji,Segoe UI Emoji}
    a{color:#aecdff;text-decoration:none}
    a:hover{text-decoration:underline}
    header{position:sticky;top:0;background:linear-gradient(180deg,rgba(17,23,42,.95),rgba(17,23,42,.75));backdrop-filter:saturate(1.2) blur(8px);z-index:10;border-bottom:1px solid #233}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .brand{display:flex;gap:10px;align-items:center}
    .brand .dot{width:12px;height:12px;border-radius:50%;background:var(--accent);box-shadow:0 0 18px var(--accent)}
    nav{display:flex;gap:18px;align-items:center}
    .rows{display:grid;grid-template-columns:1fr;gap:16px;margin-top:16px}
    @media(min-width:900px){.rows{grid-template-columns:1.1fr .9fr}}
    .card{background:var(--card);border:1px solid #26354a;border-radius:14px;padding:16px;box-shadow:0 8px 28px rgba(0,0,0,.3)}
    .cards{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(min-width:700px){.cards{grid-template-columns:repeat(6,1fr)}}
    .stat{padding:12px;border:1px solid #2b3d59;border-radius:12px;background:rgba(22,28,48,.6)}
    .k{color:var(--muted);font-size:12px}
    .v{font-size:22px;font-weight:700}
    .delta.up{color:var(--up)}
    .delta.down{color:var(--down)}
    .flex{display:flex;gap:14px;align-items:center;justify-content:space-between}
    .h{font-weight:700;letter-spacing:.2px}
    .mini{font-size:12px;color:var(--muted)}
    .pill{display:inline-flex;gap:8px;align-items:center;border:1px solid #2b3d59;border-radius:999px;padding:6px 10px;background:rgba(22,28,48,.6)}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .section{margin-top:18px}
    .tbl{width:100%;border-collapse:collapse}
    .tbl th,.tbl td{border-bottom:1px solid #223449;padding:10px 8px;text-align:left}
    .tbl th{color:#a8bdd6;font-weight:600}
    .svgwrap{height:260px;width:100%;border-radius:12px;border:1px solid #2b3d59;background:rgba(22,28,48,.6);overflow:hidden}
    .svgwrap svg{width:100%;height:100%;display:block}
    footer{color:#92a7be;margin:40px 0 60px}
    .hide{display:none}
    .btn{border:1px solid #2b3d59;background:#121a2d;color:#cfe1ff;border-radius:10px;padding:8px 12px;cursor:pointer}
    .btn:hover{filter:brightness(1.1)}
    .list{display:grid;gap:8px}
    .code{white-space:pre-wrap;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;background:#0c1326;border:1px solid #26354a;border-radius:10px;padding:12px;max-height:420px;overflow:auto}

    /* ===== BM20 ë‰´ìŠ¤ ì¹´ë“œ ì „ìš© ìŠ¤íƒ€ì¼ (ì¶©ëŒ ì—†ìŒ) ===== */
    .bm-wrap{max-width:1100px;margin:0 auto}
    .bm-grid{display:grid;grid-template-columns:3fr 2fr;gap:16px}
    .bm-card{background:linear-gradient(180deg,#11183a 0%,#0f152b 100%);border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:18px;box-shadow:0 12px 30px rgba(0,0,0,.35)}
    .bm-title{font-size:20px;font-weight:800;margin-bottom:10px;color:#dfe5ff}
    .bm-head{font-size:22px;font-weight:900;margin:6px 0 10px}
    .bm-lead{font-size:16px;color:#d9e3ff;margin-bottom:10px}
    .bm-pill{display:inline-block;border:1px solid rgba(255,255,255,.14);padding:6px 10px;border-radius:999px;font-size:12px;color:#a7b0c0;margin-right:8px}
    .bm-kicker{color:#a7b0c0;font-size:12px;letter-spacing:.2px}
    .bm-bars{margin-top:8px}
    .bm-row{display:grid;grid-template-columns:50px 1fr 70px;align-items:center;gap:10px;margin:6px 0}
    .bm-shell{background:rgba(255,255,255,.08);height:18px;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,.08)}
    .bm-bar{height:100%;background:#2E7D32}
    .bm-pct{text-align:right;font-variant-numeric:tabular-nums;color:#e6f5ea;font-weight:700}
    .bm-ticker{font-weight:700;color:#e9edf7;text-align:center}
    .bm-legend{display:flex;gap:10px;margin-top:6px;color:#dfe5ff;font-size:12px}
  </style>
</head>
<body>
  <header>
    <div class="wrap flex">
      <div class="brand"><span class="dot"></span><div>
        <div style="font-weight:800">BM20 Index</div>
        <div class="mini">Blockmedia Largeâ€‘Cap Crypto 20</div>
      </div></div>
      <nav>
          <a href="{{ '/' | relative_url }}">Home</a>
          <a href="{{ '/latest.html' | relative_url }}">Latest</a>
          <a href="{{ '/indices/performance/' | relative_url }}">Charts (Full)</a>
          <a href="{{ '/indices/components/'  | relative_url }}">Data</a>
          <a href="{{ '/indices/overview/'    | relative_url }}">About</a>
        </nav>
    </div>
  </header>

  <main class="wrap">
    <!-- LATEST -->
    <section id="latest" class="card">
      <div class="flex">
        <div>
          <div class="h">ì˜¤ëŠ˜ì˜ BM20</div>
          <div class="mini" id="asof">â€”</div>
        </div>
        <div class="pill"><span id="deltaBadge">â€”</span></div>
      </div>

      <div class="cards section">
        <div class="stat"><div class="k">ì§€ìˆ˜ ë ˆë²¨</div><div class="v" id="level">â€”</div></div>
        <div class="stat"><div class="k">1D</div><div class="v" id="r1d">â€”</div></div>
        <div class="stat"><div class="k">7D</div><div class="v" id="r7d">â€”</div></div>
        <div class="stat"><div class="k">30D</div><div class="v" id="r30d">â€”</div></div>
        <div class="stat"><div class="k">MTD</div><div class="v" id="rmtd">â€”</div></div>
        <div class="stat"><div class="k">1Y</div><div class="v" id="r1y">â€”</div></div>
        <div class="stat"><div class="k">YTD</div><div class="v" id="rytd">â€”</div></div>
      </div>

      <div class="grid2 section">
        <div>
          <div class="mini">ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„</div>
          <div class="v" id="kimchi">â€”</div>
        </div>
        <div>
          <div class="mini">í€ë”©ë¹„(ì„ ë¬¼)</div>
          <div class="v" id="funding">â€”</div>
        </div>
      </div>

      <div class="section list mini">
        <div>ë¹ ë¥¸ ë§í¬: 
          <a href="series.json" target="_blank">series.json</a> Â·
          <a href="latest.json" target="_blank">latest.json</a> Â·
          <a id="newsLink" class="hide" href="#" target="_blank">news.txt</a>
        </div>
      </div>
    </section>

    <!-- CHARTS -->
    <section id="charts" class="rows">
      <div class="card">
        <div class="flex"><div class="h">BM20 ì‹œê³„ì—´</div><button class="btn" id="btnZoom">ë²”ìœ„: 1Y â–¾</button></div>
        <div class="svgwrap" id="svgHost"><svg></svg></div>
        <div class="mini">â€» series.jsonì„ ì½ì–´ ë‹¨ìˆœ ë¼ì¸ ì°¨íŠ¸ë¡œ ê·¸ë¦½ë‹ˆë‹¤. ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì•„ë˜ì— í‘œì‹œí•©ë‹ˆë‹¤.</div>
      </div>
      <div class="card">
        <div class="h">ì´ë¯¸ì§€ ì°¨íŠ¸(ìˆì„ ê²½ìš°ë§Œ)</div>
        <div class="grid2 section">
          <div>
            <div class="mini">1D Performance Bar</div>
            <img id="imgBar" alt="1D Bar" style="max-width:100%;border:1px solid #2b3d59;border-radius:10px"/>
          </div>
          <div>
            <div class="mini">BTC & ETH 7D Trend</div>
            <img id="imgTrend" alt="7D Trend" style="max-width:100%;border:1px solid #2b3d59;border-radius:10px"/>
          </div>
        </div>
      </div>
    </section>

    <!-- DATA / JSON VIEW -->
    <section id="data" class="rows section">
      <div class="card">
        <div class="flex"><div class="h">latest.json</div><button class="btn" id="btnToggleLatest">ì ‘ê¸°</button></div>
        <pre id="latestDump" class="code">â€”</pre>
      </div>
      <div class="card">
        <div class="flex"><div class="h">series.json (ë§ˆì§€ë§‰ 20í–‰)</div><button class="btn" id="btnToggleSeries">ì ‘ê¸°</button></div>
        <pre id="seriesDump" class="code">â€”</pre>
      </div>
    </section>

    <!-- ===== ì—¬ê¸°ë¶€í„°: ë‰´ìŠ¤ ì¹´ë“œ ë¸”ë¡ ì‚½ì… ===== -->
    <section class="section">
      <div class="bm-wrap">
        <div class="bm-kicker">BM20 ë°ì¼ë¦¬ í—ˆë¸Œ Â· í”„ë¦¬ë·°</div>
        <h2 class="h">ë‰´ìŠ¤ & í¼í¬ë¨¼ìŠ¤</h2>

        <div class="bm-grid">
          <!-- Left: ì½”ì¸ë³„ í¼í¬ë¨¼ìŠ¤ (ìƒ˜í”Œ ê°’, ë°ì´í„° ì—°ë™ ì „) -->
          <section class="bm-card">
            <div class="bm-title">ì½”ì¸ë³„ í¼í¬ë¨¼ìŠ¤ (1D, USD)</div>
            <div class="bm-bars" aria-label="1ì¼ ìˆ˜ìµë¥  ë§‰ëŒ€">
              <div class="bm-row"><div class="bm-ticker">ARB</div><div class="bm-shell"><div class="bm-bar" style="width:20%"></div></div><div class="bm-pct">+19.99%</div></div>
              <div class="bm-row"><div class="bm-ticker">OP</div><div class="bm-shell"><div class="bm-bar" style="width:9.6%"></div></div><div class="bm-pct">+9.50%</div></div>
              <div class="bm-row"><div class="bm-ticker">ADA</div><div class="bm-shell"><div class="bm-bar" style="width:8.4%"></div></div><div class="bm-pct">+8.35%</div></div>
              <div class="bm-row"><div class="bm-ticker">NEAR</div><div class="bm-shell"><div class="bm-bar" style="width:7.1%"></div></div><div class="bm-pct">+7.09%</div></div>
              <div class="bm-row"><div class="bm-ticker">BTC</div><div class="bm-shell"><div class="bm-bar" style="width:2.6%"></div></div><div class="bm-pct">+2.63%</div></div>
              <div class="bm-row"><div class="bm-ticker">ETH</div><div class="bm-shell"><div class="bm-bar" style="width:3.4%"></div></div><div class="bm-pct">+3.43%</div></div>
            </div>
          </section>

          <!-- Right: ë‰´ìŠ¤ ì¹´ë“œ -->
          <section class="bm-card">
            <div class="bm-title">BM20 ë°ì¼ë¦¬ ë‰´ìŠ¤</div>
            <div class="bm-head">BM20 ì§€ìˆ˜ 0.9% í•˜ë½â€¦BTCÂ·ETH ì•½ì„¸</div>
            <div class="bm-lead">23ì¼ BM20 ì§€ìˆ˜ëŠ” ì „ì¼ ëŒ€ë¹„ 0.9% ë‚´ë¦° 6,993ptë¡œ ë§ˆê°í–ˆìŠµë‹ˆë‹¤. ë¹„íŠ¸ì½”ì¸ê³¼ ì´ë”ë¦¬ì›€ì´ ë™ë°˜ ì•½ì„¸ë¥¼ ë³´ì´ë©° ì§€ìˆ˜ í•˜ë½ì„ ì£¼ë„í–ˆìŠµë‹ˆë‹¤.</div>
            <p class="mini" style="line-height:1.75;margin:6px 0 0;">
              20ê°œ ì¢…ëª© ì¤‘ <b>ìƒìŠ¹ 7</b> Â· <b>í•˜ë½ 13</b>. ì£¼ê°„ ìˆ˜ìµë¥ ì€ <b>+2.9%</b>, ì›”ê°„ ìˆ˜ìµë¥ ì€ <b>+13.7%</b>ë¡œ ì¤‘ê¸° ìƒìŠ¹ íë¦„ì€ ìœ ì§€ë˜ê³  ìˆìŠµë‹ˆë‹¤.
            </p>
            <div style="margin-top:10px;">
              <span class="bm-pill">Best 3: ARB Â· OP Â· ADA</span>
              <span class="bm-pill">Worst 3: LTC Â· XRP Â· BNB</span>
            </div>
          </section>
        </div>
      </div>
    </section>
    <!-- ===== ì‚½ì… ë ===== -->

    <!-- ABOUT -->
    <section id="about" class="card section">
      <div class="h">What is BM20?</div>
      <p class="mini">ê¸€ë¡œë²Œ ì•”í˜¸í™”í ì‹œì¥ì„ ëŒ€í‘œí•˜ëŠ” ëŒ€í˜• ì½”ì¸ 20ê°œë¡œ êµ¬ì„±í•œ ë¸”ë¡ë¯¸ë””ì–´ ê³ ìœ  ì§€ìˆ˜ì…ë‹ˆë‹¤. í•œêµ­ 3ëŒ€ ê±°ë˜ì†Œ(ì—…ë¹„íŠ¸Â·ë¹—ì¸Â·ì½”ì¸ì›) ìƒì¥ ì½”ì¸ì€ 1.3Ã— ë³´ì • ê°€ì¤‘ì¹˜ë¥¼ ì ìš©í•˜ë©°, ë¶„ê¸° 1íšŒ ì •ê¸° ë¦¬ë°¸ëŸ°ì‹±(1Â·4Â·7Â·10ì›”)í•©ë‹ˆë‹¤. ì§€ìˆ˜ ê¸°ì¤€ì¼ì€ 2018â€‘01â€‘01(100)ì´ë©°, í¬íŠ¸í´ë¦¬ì˜¤ ê°€ì¹˜ë¥¼ ê¸°ì¤€ ê°€ì¹˜ë¡œ ë‚˜ëˆ  ì‚°ì¶œí•©ë‹ˆë‹¤.</p>
      <ul class="mini">
        <li>ì½”ì¸ ì„ ì •: ì‹œê°€ì´ì•¡ ìƒìœ„ 20ì¢… (APT ì œì™¸, SUI í¬í•¨ ê°€ëŠ¥)</li>
        <li>ê°€ì¤‘ì¹˜ ì˜ˆì‹œ: BTC 30%, ETH 20%, XRP 5%, USDT 5%, BNB 5%, ë‚˜ë¨¸ì§€ 15ì¢…ì— ê· ë“± ë°°ë¶„(ì´ 35%)</li>
        <li>ë°ì´í„° ì†ŒìŠ¤: ê¸°ë³¸ ì½”ì¸ê²Œì½”, ì´ìŠˆ ì‹œ ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ í´ë°±</li>
        <li>í™œìš©: ì¼ì¼ ì‹œí™© ì½”ë©˜í„°ë¦¬, ìë™í™” íŒŒì´í”„ë¼ì¸, í–¥í›„ ETF/íŒŒìƒ ë²¤ì¹˜ë§ˆí¬</li>
      </ul>
    </section>

    <footer class="mini">
      <div>Â© Blockmedia Â· Generated clientâ€‘side from <code>latest.json</code> & <code>series.json</code>. ì´ë¯¸ì§€/ë‰´ìŠ¤ íŒŒì¼ì´ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ìˆ¨ê²¨ì§‘ë‹ˆë‹¤.</div>
    </footer>
  </main>

<script>
/* ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ (latest/series ë¡œë”©) */
const qs = (s, el=document) => el.querySelector(s);
const fmtPct = v => (v===null||v===undefined||isNaN(v))?"â€”":(v>0?"+":"") + (Math.round(v*1000)/10).toFixed(1) + "%";
const fmtNum = v => (v===null||v===undefined||isNaN(v))?"â€”": new Intl.NumberFormat('en-US',{maximumFractionDigits:2}).format(v);
const findKey = (obj, candidates=[]) => { for (const k of candidates){ if (obj && Object.hasOwn(obj,k)) return obj[k]; } };

async function fetchAny(urls){ for (const u of urls){ try{ const r=await fetch(u); if(r.ok) return {url:u,json:await r.json()}; }catch(e){} } throw new Error('no json found'); }
function setDeltaBadge(pct){ const el=qs('#deltaBadge'); if(pct==null||isNaN(pct)){ el.textContent='ë°ì´í„° ì—†ìŒ'; return; } el.textContent=(pct>0?'â–² ':'â–¼ ')+fmtPct(pct); el.className='delta '+(pct>=0?'up':'down'); }
function setImg(id, src){ const img=qs(id); img.src=src; img.onerror=()=>img.closest('div').classList.add('hide'); }
function formatFunding(f){ if(f==null) return 'â€”'; if(typeof f==='number') return fmtPct(f); if(typeof f==='string') return f;
  if(typeof f==='object'){ const btc=f.btc??f.BTC??f.Btc, eth=f.eth??f.ETH??f.Eth; const p=x=>(typeof x==='number')?fmtPct(x):(x??'â€”'); return `BTC ${p(btc)}, ETH ${p(eth)}`;} return 'â€”';
}

async function loadLatest(){
  try{
    const { url, json: j } = await fetchAny([
      'bm20_latest.json','latest.json','bm/bm20_latest.json','bm/latest.json'
    ]);

    const asof = j.asOf || j.as_of || j.date || j.day || '';
    if (asof) qs('#asof').textContent = `ê¸°ì¤€: ${asof}`;

    const level = j.bm20Level ?? j.level ?? j.index ?? j.value;
    qs('#level').textContent = fmtNum(level);

    const R = j.returns || {};
    const r1 = j.bm20ChangePct ?? R['1D'];
    qs('#r1d').textContent = fmtPct(r1);

    if (qs('#r7d'))  qs('#r7d').textContent  = fmtPct(R['7D']);
    if (qs('#r30d')) qs('#r30d').textContent = fmtPct(R['30D']);
    // ğŸŸ¨ MTD ì œê±°: rmtd ìš”ì†Œ/ë°ì´í„° ì ‘ê·¼ ì—†ìŒ
    if (qs('#rytd')) qs('#rytd').textContent = fmtPct(R['YTD']);
    if (qs('#r1y'))  qs('#r1y').textContent  = fmtPct(R['1Y']);

    setDeltaBadge(r1);

    const kimchi  = findKey(j, ['kimchi_premium','kimchi','krw_premium']);
    const funding = findKey(j, ['funding_rate','funding','funding_bps','fundingRate']);
    qs('#kimchi').textContent  = kimchi!=null ? (typeof kimchi==='number' ? fmtPct(kimchi) : kimchi) : 'â€”';
    qs('#funding').textContent = formatFunding(funding);

    const news = j.news_file || j.news_path || j.news;
    if (news && typeof news === 'string') {
      const a = qs('#newsLink'); a.href = news; a.classList.remove('hide');
    } else {
      fetch('bm20_news_latest.txt').then(x=>{
        if (x.ok) { const a = qs('#newsLink'); a.href='bm20_news_latest.txt'; a.classList.remove('hide'); }
      });
    }

    qs('#latestDump').textContent = JSON.stringify(j, null, 2);

  } catch(e) {
    qs('#latestDump').textContent = 'latest.jsonì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
  }
}


async function loadSeries(){
  const host=qs('#svgHost'); const svg=qs('svg', host);
  try{
    const { url, json: arr } = await fetchAny(['bm20_series.json','series.json','bm/bm20_series.json','bm/series.json']);
    const points = arr.map(d=>({ t:new Date((d.date||d.day||d.asof||d.asOf||d[0]||Date.now())), v:+((d.level||d.index||d.value||d.close||d.bm20Level||d[1])) }))
                      .filter(x=>isFinite(x.v)).sort((a,b)=>a.t-b.t);
    qs('#seriesDump').textContent = `${url}
`+JSON.stringify(points.slice(-20),null,2);

    let mode=0; const compute=()=>{ if(mode===1){ const y0=new Date(new Date().getFullYear(),0,1); return points.filter(p=>p.t>=y0); }
                                   if(mode===0){ const d=new Date(); d.setFullYear(d.getFullYear()-1); return points.filter(p=>p.t>=d); }
                                   return points; };

    function draw(data){
      svg.innerHTML=''; const pad=24, W=svg.clientWidth||host.clientWidth, H=svg.clientHeight||host.clientHeight;
      const minX=+data[0].t,maxX=+data[data.length-1].t,minV=Math.min(...data.map(p=>p.v)),maxV=Math.max(...data.map(p=>p.v));
      const x=t=> pad+((t-minX)/(maxX-minX))*(W-2*pad), y=v=> H-pad-((v-minV)/(maxV-minV||1))*(H-2*pad);
      const axes=document.createElementNS('http://www.w3.org/2000/svg','path'); axes.setAttribute('d',`M${pad} ${pad}V${H-pad}H${W-pad}`); axes.setAttribute('stroke','#2b3d59'); axes.setAttribute('fill','none'); svg.appendChild(axes);
      const path=document.createElementNS('http://www.w3.org/2000/svg','path'); let d=''; data.forEach((p,i)=>{d+=(i?'L':'M')+x(+p.t)+' '+y(p.v)+' ';}); path.setAttribute('d',d.trim()); path.setAttribute('fill','none'); path.setAttribute('stroke',getComputedStyle(document.documentElement).getPropertyValue('--accent')); path.setAttribute('stroke-width','2'); svg.appendChild(path);
      const last=data[data.length-1]; const dot=document.createElementNS('http://www.w3.org/2000/svg','circle'); dot.setAttribute('cx',x(+last.t)); dot.setAttribute('cy',y(last.v)); dot.setAttribute('r','3.5'); dot.setAttribute('fill','white'); dot.setAttribute('stroke',getComputedStyle(document.documentElement).getPropertyValue('--accent')); svg.appendChild(dot);
    }
    const doDraw=()=>{ const d=compute(); if(d.length>1) draw(d); }; doDraw();
    qs('#btnZoom').addEventListener('click',()=>{ mode=(mode+1)%3; qs('#btnZoom').textContent=['ë²”ìœ„: 1Y â–¾','ë²”ìœ„: YTD â–¾','ë²”ìœ„: ALL â–¾'][mode]; doDraw(); });
  }catch(e){ qs('#seriesDump').textContent='series.jsonì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'; }
}

function tryImages(){ setImg('#imgBar','bm20_bar_latest.png'); setImg('#imgTrend','bm20_trend_latest.png'); }

qs('#btnToggleLatest').addEventListener('click',()=>qs('#latestDump').classList.toggle('hide'));
qs('#btnToggleSeries').addEventListener('click',()=>qs('#seriesDump').classList.toggle('hide'));

loadLatest(); loadSeries(); tryImages();
</script>
</body>
</html>
