<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Kimchi Top10 (Market)</title>
  <style>
    body{margin:0;background:#0b0d10;color:#e8eaed;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
    .wrap{max-width:980px;margin:28px auto;padding:0 16px}
    .card{background:#12161c;border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:16px 16px 8px}
    h1{font-size:20px;margin:0 0 8px}
    .meta{opacity:.75;font-size:13px;margin:0 0 14px}
    .kpis{display:flex;gap:12px;flex-wrap:wrap;margin:10px 0 14px}
    .kpi{flex:1;min-width:220px;background:#0e1217;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px}
    .kpi .label{opacity:.75;font-size:12px}
    .kpi .value{font-size:18px;margin-top:4px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:12px 10px;border-top:1px solid rgba(255,255,255,.06);text-align:right;font-variant-numeric:tabular-nums}
    th:first-child,td:first-child{text-align:left}
    th{opacity:.75;font-size:12px}
    .pos{color:#39d98a}
    .neg{color:#ff5c5c}
    .muted{opacity:.6}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Kimchi Premium Top10 (Market 기준)</h1>
      <p class="meta" id="meta">—</p>

      <div class="kpis">
        <div class="kpi">
          <div class="label">USD/KRW (Market, Yahoo KRW=X)</div>
          <div class="value" id="usdkrw">—</div>
        </div>
        <div class="kpi">
          <div class="label">USDT/KRW (Domestic, Upbit KRW-USDT)</div>
          <div class="value" id="usdtkrw">—</div>
        </div>
        <div class="kpi">
          <div class="label">FX Premium (Domestic vs Market)</div>
          <div class="value" id="fxp">—</div>
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>코인</th>
            <th>현재가(Upbit KRW)</th>
            <th>김프(Market)</th>
            <th>직전대비(Δpp)</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>
  </div>

<script>
const fmt = (n, d=2) => (n===null||n===undefined) ? "—" : Number(n).toLocaleString(undefined,{maximumFractionDigits:d});
const pct = (n, d=2) => (n===null||n===undefined) ? "—" : `${(Number(n)).toFixed(d)}%`;
const cls = (n) => (n===null||n===undefined) ? "muted" : (n>=0 ? "pos" : "neg");

async function main(){
  // GitHub Pages면 /bm/ 경로 고려해서 상대경로 추천
  const url = "../out/history/kimchi_top10_latest.json";
  const j = await (await fetch(url, {cache:"no-store"})).json();

  if(j.status !== "ok"){
    document.getElementById("meta").textContent = `오류: ${j.error || "unknown"}`;
    return;
  }
  document.getElementById("meta").textContent = `${j.timestamp_label} · 정의: Market 기준 (Yahoo USD + Yahoo FX)`;
  document.getElementById("usdkrw").textContent = fmt(j.fx.usdkrw_market, 2);
  document.getElementById("usdtkrw").textContent = j.fx.usdtkrw_domestic ? fmt(j.fx.usdtkrw_domestic, 2) : "—";
  document.getElementById("fxp").textContent = j.fx.fx_premium_pct!==null ? pct(j.fx.fx_premium_pct, 2) : "—";
  document.getElementById("fxp").className = cls(j.fx.fx_premium_pct);

  const rows = document.getElementById("rows");
  rows.innerHTML = "";
  for(const c of j.coins){
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${c.coin}</td>
      <td>${c.upbit_krw ? fmt(c.upbit_krw, 0) : "—"}</td>
      <td class="${cls(c.premium_market_pct)}">${pct(c.premium_market_pct, 2)}</td>
      <td class="${cls(c.delta_pp)}">${c.delta_pp===null ? "—" : (c.delta_pp>=0?"+":"") + c.delta_pp.toFixed(2) + "pp"}</td>
    `;
    rows.appendChild(tr);
  }
}
main();
</script>
</body>
</html>
