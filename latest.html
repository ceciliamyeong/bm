<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>BM20 Latest</title>
<style>
  :root{--up:#2E7D32;--down:#C62828;--navy:#1A237E;--card: #f7f8fa}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,sans-serif;background:#fff;color:#111}
  header{background:var(--navy);color:#fff;padding:20px}
  header .title{font-weight:700;font-size:24px}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .grid{display:grid;gap:16px}
  @media(min-width:960px){.grid-2{grid-template-columns:1fr 1fr}}
  .card{background:var(--card);border-radius:16px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.06)}
  .hero{display:flex;align-items:baseline;gap:12px;flex-wrap:wrap}
  .hero .level{font-size:42px;font-weight:800}
  .chip{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:700}
  .up{color:var(--up);background:#e9f4ec}.down{color:var(--down);background:#fbecec}
  .section-title{font-weight:800;margin:0 0 8px}
  .kv{display:grid;gap:8px;grid-template-columns:repeat(5,minmax(0,1fr))}
  .kv .k{font-size:12px;color:#666}.kv .v{font-weight:700}
  .list{display:grid;gap:8px}
  .cols-2{display:grid;gap:16px}@media(min-width:960px){.cols-2{grid-template-columns:2fr 1fr}}
  footer{color:#666;padding:24px;font-size:13px}
  img{max-width:100%;height:auto;border-radius:12px;display:block}
  a{color:var(--navy);text-decoration:none}
  .btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .btn{padding:8px 12px;border-radius:12px;background:#eef1ff;color:#1A237E;font-weight:700}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="title">BM20 Index</div>
    <div class="btns">
      <a class="btn" href="./methodology/">What is BM20?</a>
      <a class="btn" href="./news/">BM20 뉴스</a>
      <a class="btn" href="./archive/">아카이브</a>
    </div>
  </div>
</header>

<main class="wrap grid">
  <!-- Hero -->
  <section class="card">
    <div class="hero">
      <div class="level mono" data-bm20="index_level">--</div>
      <div class="chip" id="chip-change">--</div>
      <div style="font-size:13px;color:#eee;background:#222;border-radius:8px;padding:4px 8px;margin-left:auto" data-bm20="date_seoul">--</div>
    </div>
    <div class="kv" style="margin-top:12px">
      <div><div class="k">1D</div><div class="v" data-bm20="ret_1d">--</div></div>
      <div><div class="k">7D</div><div class="v" data-bm20="ret_7d">--</div></div>
      <div><div class="k">30D</div><div class="v" data-bm20="ret_30d">--</div></div>
      <div><div class="k">MTD</div><div class="v" data-bm20="ret_mtd">--</div></div>
      <div><div class="k">YTD</div><div class="v" data-bm20="ret_ytd">--</div></div>
    </div>
  </section>

  <!-- Charts + Best/Worst -->
  <section class="cols-2">
    <div class="card">
      <div class="section-title">1D Performance (Constituents)</div>
      <img alt="BM20 1D Performance" src="./bm20_bar_latest.png">
    </div>
    <aside class="card">
      <div class="section-title">Best 3 / Worst 3</div>
      <div class="list mono">
        <div id="best3">Best — --</div>
        <div id="worst3">Worst — --</div>
      </div>
      <div style="height:8px"></div>
      <div class="section-title">BTC &amp; ETH 7D</div>
      <img alt="BTC/ETH 7D" src="./bm20_trend_latest.png">
    </aside>
  </section>

  <!-- Market extras -->
  <section class="grid grid-2">
    <div class="card">
      <div class="section-title">김치 프리미엄</div>
      <div class="mono" data-bm20="kimchi_prem">--</div>
    </div>
    <div class="card">
      <div class="section-title">펀딩비 (Binance)</div>
      <div class="mono" data-bm20="funding_rate">--</div>
    </div>
  </section>

  <!-- News -->
  <section class="card">
    <div class="section-title">BM20 데일리 리포트</div>
    <div class="list">
      <div><strong data-bm20="report_title">--</strong></div>
      <div data-bm20="report_summary">--</div>
      <div><a id="report_link" href="#">전체 리포트 보기 →</a></div>
    </div>
  </section>
</main>

<footer class="wrap">
  데이터: CoinGecko(기본), Yahoo Finance(폴백). 본 정보는 투자 자문이 아닙니다.
</footer>

<!-- ✅ 데이터 바인딩 스크립트 -->
<script>
(async () => {
  try {
    const resp = await fetch('./bm20_latest.json', { cache: 'no-store' });
    const d = await resp.json();

    // 숫자 채우기
    const put = (key, fmt = (x)=>x) =>
      document.querySelectorAll(`[data-bm20="${key}"]`).forEach(el=>{
        const v = d[key];
        el.textContent = (v==null||v==="") ? '--' : (typeof v==="number"?fmt(v):v);
      });

    put('index_level', x => x.toFixed(2));
    ['ret_1d','ret_7d','ret_30d','ret_mtd','ret_ytd'].forEach(k =>
      put(k, x => (x>=0?'+':'')+x.toFixed(2)+'%')
    );
    put('date_seoul');
    put('kimchi_prem');
    put('funding_rate');
    put('report_title');
    put('report_summary');

    // 등락 칩 표시
    const chip = document.getElementById('chip-change');
    if (chip && d.ret_1d !== undefined) {
      chip.textContent = (d.change_abs || '') + ' (' + (d.change_pct || '') + ')';
      chip.classList.add(d.ret_1d >= 0 ? 'up':'down');
    }

    // Best/Worst
    const fill = (arr, id) => {
      const box = document.getElementById(id);
      if (!box) return;
      box.textContent = id==='best3'
        ? 'Best — ' + (arr||[]).join(', ')
        : 'Worst — ' + (arr||[]).join(', ');
    };
    fill(d.best3, 'best3');
    fill(d.worst3, 'worst3');

    // 리포트 링크
    if (d.report_slug) {
      document.getElementById('report_link').href = './news/' + d.report_slug + '/';
    }

  } catch(e) {
    console.error('BM20 load error', e);
  }
})();
</script>
</body>
</html>
